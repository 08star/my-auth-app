# ----------------------------------------------------------------
# 1. 指定基底映像：一定要是這個格式，沒有空格縮排
# ----------------------------------------------------------------
FROM python:3.9-slim

# ----------------------------------------------------------------
# 2. 設定工作目錄
# ----------------------------------------------------------------
WORKDIR /app

# ----------------------------------------------------------------
# 3. 複製並安裝相依
# ----------------------------------------------------------------
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ----------------------------------------------------------------
# 4. 複製所有程式碼（包括 templates、static）
# ----------------------------------------------------------------
COPY . .

# ----------------------------------------------------------------
# 5. Cloud Run 會用 $PORT，預設 8080
# ----------------------------------------------------------------
ENV PORT 8080
EXPOSE 8080

# ----------------------------------------------------------------
# 6. 啟動指令：綁到 0.0.0.0:8080，並且 import app.py 的 app 物件
# ----------------------------------------------------------------
CMD ["gunicorn", "--bind", "0.0.0.0:8080", "app:app", "--workers", "2"]
